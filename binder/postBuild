#!/usr/bin/env bash
set -euo pipefail

# Binderâ€™s conda env created from environment.yml lives here:
PREFIX="/srv/conda/envs/notebook"

# ---- Force classic UI on Jupyter Server, disable Lab, land on /tree ----
JS_CONF_D="$PREFIX/etc/jupyter/jupyter_server_config.d"
mkdir -p "$JS_CONF_D"
cat > "$JS_CONF_D/000-ui.json" <<'JSON'
{
  "ServerApp": {
    "jpserver_extensions": {
      "jupyterlab": false,
      "nbclassic": true
    },
    "default_url": "/tree"
  }
}
JSON

# (Optional) also drop a classic-only default for NotebookApp just in case:
JN_CONF_D="$PREFIX/etc/jupyter/jupyter_notebook_config.d"
mkdir -p "$JN_CONF_D"
cat > "$JN_CONF_D/000-default-url.json" <<'JSON'
{
  "NotebookApp": {
    "default_url": "/tree"
  }
}
JSON

# ---- Pre-enable your classic nbextensions (no CLI needed) ----
NB_D="$PREFIX/etc/jupyter/nbconfig/notebook.d"
mkdir -p "$NB_D"
cat > "$NB_D/enable_extensions.json" <<'JSON'
{
  "load_extensions": {
    "toc2/main": true,
    "collapsible_headings/main": true,
    "execute_time/ExecuteTime": true,
    "hinterland/hinterland": true,
    "codefolding/main": true,
    "varInspector/main": true,
    "exercise2/main": true,
    "ruler/main": true,
    "scroll_down/main": true,
    "splitcell/main": true,
    "freeze/main": true
  }
}
JSON
