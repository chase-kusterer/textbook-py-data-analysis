#!/usr/bin/env bash
set -euo pipefail

ENV_NAME=notebook
CONDA_PREFIX_PATH="$(conda run -n "$ENV_NAME" bash -lc 'echo -n "$CONDA_PREFIX"')"

JS_CONF_D="$CONDA_PREFIX_PATH/etc/jupyter/jupyter_server_config.d"
NB_D="$CONDA_PREFIX_PATH/etc/jupyter/nbconfig/notebook.d"
mkdir -p "$JS_CONF_D" "$NB_D"

# Hard-disable JupyterLab even if itâ€™s present; enable nbclassic; land on /tree
cat > "$JS_CONF_D/000-nb-ui.json" <<'JSON'
{
  "ServerApp": {
    "jpserver_extensions": {
      "jupyterlab": false,
      "nbclassic": true
    },
    "default_url": "/tree"
  }
}
JSON

# Enable your classic nbextensions
cat > "$NB_D/enable_extensions.json" <<'JSON'
{
  "load_extensions": {
    "toc2/main": true,
    "collapsible_headings/main": true,
    "execute_time/ExecuteTime": true,
    "hinterland/hinterland": true,
    "codefolding/main": true,
    "varInspector/main": true
  }
}
JSON

echo "[postBuild] Wrote configs under $CONDA_PREFIX_PATH/etc/jupyter"
